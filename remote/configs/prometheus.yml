# =============================================================================
# Prometheus Configuration
# =============================================================================
# Central metrics hub receiving remote_write from local GPU server.
# Also scrapes local services on the Hetzner host.
#
# Remote write receiver enabled via --web.enable-remote-write-receiver flag.
# =============================================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'hetzner-hub'
    environment: 'production'

# Scrape configurations for local services
scrape_configs:
  # Self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    relabel_configs:
      - target_label: instance
        replacement: 'hetzner-hub'

  # Caddy metrics
  - job_name: 'caddy'
    static_configs:
      - targets: ['caddy:2019']
    metrics_path: /metrics

  # Loki metrics
  - job_name: 'loki'
    static_configs:
      - targets: ['loki:3100']
    metrics_path: /metrics

  # MinIO metrics
  - job_name: 'minio'
    static_configs:
      - targets: ['minio:9000']
    metrics_path: /minio/v2/metrics/cluster
    scheme: http

  # PostgreSQL metrics (if pg_exporter is added)
  # - job_name: 'postgres'
  #   static_configs:
  #     - targets: ['postgres-exporter:9187']

# Recording rules for commonly used queries
# rule_files:
#   - /etc/prometheus/rules/*.yml
